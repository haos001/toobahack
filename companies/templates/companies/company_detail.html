{% extends 'companies/base.html' %}

{% block title %}{{ company.name }} - Круг добра{% endblock %}

{% block content %}
<script src="https://cdn.tailwindcss.com"></script>
<style>
.fade-in-up {
    opacity: 0;
    transform: translateY(20px);
    animation: fadeInUp 0.6s ease forwards;
}
@keyframes fadeInUp {
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
.hover-scale {
    transition: transform 0.3s ease;
}
.hover-scale:hover {
    transform: scale(1.05);
}
.hover-lift {
    transition: all 0.3s ease;
}
.hover-lift:hover {
    transform: translateY(-4px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
}
.animated-gradient {
    background: linear-gradient(-45deg, #3b82f6, #8b5cf6, #06b6d4, #10b981);
    background-size: 400% 400%;
    animation: gradient 8s ease infinite;
}
@keyframes gradient {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
}
.pulse-heartbeat {
    animation: pulse-heartbeat 2s infinite;
}
@keyframes pulse-heartbeat {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
}
.floating {
    animation: floating 3s ease-in-out infinite;
}
@keyframes floating {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
}
</style>
<div class="max-w-4xl mx-auto p-4 space-y-6 bg-gradient-to-br from-gray-50 via-blue-50/20 to-gray-50 min-h-screen">
    <!-- Back Navigation -->
    <div class="fade-in-up" style="animation-delay: 0s;">
        <a href="{% url 'company_list' %}" class="inline-flex items-center gap-2 text-gray-600 hover:text-blue-600 transition-colors duration-200">
            <i class="fas fa-chevron-left"></i>
            <span>Назад</span>
        </a>
    </div>

    <!-- Company Header -->
    <div class="flex flex-col md:flex-row gap-6 items-start fade-in-up" style="animation-delay: 0.1s;">
        <div class="hover-scale">
            {% if company.logo %}
            <div class="w-24 h-24 rounded-xl border border-gray-200 shadow-md overflow-hidden bg-white">
                <img src="{{ company.logo.url }}" alt="{{ company.name }}" class="w-full h-full object-cover">
            </div>
            {% else %}
            <div class="w-24 h-24 rounded-xl border border-gray-200 shadow-md bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center text-white">
                <i class="fas fa-building text-2xl"></i>
            </div>
            {% endif %}
        </div>

        <div class="flex-1 space-y-3">
            <div class="flex items-center gap-3">
                <h1 class="text-3xl font-bold text-gray-900">{{ company.name }}</h1>
                {% if company.is_verified %}
                <div class="flex items-center gap-1 px-3 py-1 bg-green-100 text-green-700 rounded-full border border-green-200 hover-scale">
                    <i class="fas fa-check text-sm"></i>
                    <span class="text-sm font-medium">Проверено</span>
                </div>
                {% endif %}
            </div>
            <div class="inline-block px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm">
                {{ company.category.name }}
            </div>
            <p class="text-gray-600 leading-relaxed">{{ company.description }}</p>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 fade-in-up" style="animation-delay: 0.2s;">
        {% if company.phone %}
        <a href="tel:{{ company.phone }}" class="flex flex-col items-center gap-2 p-4 bg-white rounded-xl border border-gray-200 hover:border-blue-300 hover:shadow-md transition-all duration-300 hover-lift">
            <div class="w-10 h-10 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center">
                <i class="fas fa-phone text-sm"></i>
            </div>
            <span class="text-sm font-medium text-gray-700">Позвонить</span>
        </a>
        {% endif %}
        
        {% if company.email %}
        <a href="mailto:{{ company.email }}" class="flex flex-col items-center gap-2 p-4 bg-white rounded-xl border border-gray-200 hover:border-purple-300 hover:shadow-md transition-all duration-300 hover-lift">
            <div class="w-10 h-10 bg-purple-100 text-purple-600 rounded-full flex items-center justify-center">
                <i class="fas fa-envelope text-sm"></i>
            </div>
            <span class="text-sm font-medium text-gray-700">Написать</span>
        </a>
        {% endif %}
        
        {% if company.website %}
        <a href="{{ company.website }}" target="_blank" class="flex flex-col items-center gap-2 p-4 bg-white rounded-xl border border-gray-200 hover:border-green-300 hover:shadow-md transition-all duration-300 hover-lift">
            <div class="w-10 h-10 bg-green-100 text-green-600 rounded-full flex items-center justify-center">
                <i class="fas fa-globe text-sm"></i>
            </div>
            <span class="text-sm font-medium text-gray-700">Сайт</span>
        </a>
        {% endif %}
        
        <button onclick="shareCompany()" class="flex flex-col items-center gap-2 p-4 bg-white rounded-xl border border-gray-200 hover:border-amber-300 hover:shadow-md transition-all duration-300 hover-lift">
            <div class="w-10 h-10 bg-amber-100 text-amber-600 rounded-full flex items-center justify-center">
                <i class="fas fa-share-alt text-sm"></i>
            </div>
            <span class="text-sm font-medium text-gray-700">Поделиться</span>
        </button>
    </div>

    <!-- Charity Impact Card -->
    <div class="tooba-card charity-impact-card">
        <div class="card-header">
            <div class="header-icon">
                <i class="fas fa-heart"></i>
            </div>
            <div class="header-text">
                <h3>Благотворительная помощь</h3>
                <p>Вклад {{ company.name }} в развитие общества</p>
            </div>
        </div>
        
        <div class="charity-impact-content">
            <div class="impact-description">
                {{ company.charity_description }}
            </div>
            
            <div class="impact-metrics">
                <div class="metric-item">
                    <div class="metric-value">{{ company.charity_amount|floatformat:0 }} ₽</div>
                    <div class="metric-label">Размер помощи</div>
                </div>
                <div class="metric-divider"></div>
                <div class="metric-item">
                    <div class="metric-value">{{ company.get_charity_frequency_display }}</div>
                    <div class="metric-label">Периодичность</div>
                </div>
            </div>
            
            <div class="tooba-badge">
                <i class="fas fa-heart tooba-heart"></i>
                <span>Партнер Круг добра</span>
            </div>
        </div>
    </div>

    <!-- Contact Info Card -->
    <div class="tooba-card contact-card">
        <div class="card-header">
            <div class="header-icon">
                <i class="fas fa-map-marker-alt"></i>
            </div>
            <div class="header-text">
                <h3>Контактная информация</h3>
            </div>
        </div>
        
        <div class="contact-info-list">
            <div class="contact-info-item">
                <div class="info-icon">
                    <i class="fas fa-map-marker-alt"></i>
                </div>
                <div class="info-content">
                    <div class="info-label">Адрес</div>
                    <div class="info-value">{{ company.address }}</div>
                </div>
                <button class="info-action" onclick="openMap()">
                    <i class="fas fa-directions"></i>
                </button>
            </div>
            
            {% if company.phone %}
            <div class="contact-info-item">
                <div class="info-icon">
                    <i class="fas fa-phone"></i>
                </div>
                <div class="info-content">
                    <div class="info-label">Телефон</div>
                    <div class="info-value">{{ company.phone }}</div>
                </div>
                <a href="tel:{{ company.phone }}" class="info-action">
                    <i class="fas fa-phone"></i>
                </a>
            </div>
            {% endif %}
            
            {% if company.email %}
            <div class="contact-info-item">
                <div class="info-icon">
                    <i class="fas fa-envelope"></i>
                </div>
                <div class="info-content">
                    <div class="info-label">Email</div>
                    <div class="info-value">{{ company.email }}</div>
                </div>
                <a href="mailto:{{ company.email }}" class="info-action">
                    <i class="fas fa-envelope"></i>
                </a>
            </div>
            {% endif %}
            
            {% if company.website %}
            <div class="contact-info-item">
                <div class="info-icon">
                    <i class="fas fa-globe"></i>
                </div>
                <div class="info-content">
                    <div class="info-label">Веб-сайт</div>
                    <div class="info-value">{{ company.website|truncatechars:30 }}</div>
                </div>
                <a href="{{ company.website }}" target="_blank" class="info-action">
                    <i class="fas fa-external-link-alt"></i>
                </a>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Map Card -->
    {% if company.latitude and company.longitude %}
    <div class="tooba-card map-card">
        <div class="card-header">
            <div class="header-icon">
                <i class="fas fa-map"></i>
            </div>
            <div class="header-text">
                <h3>Местоположение</h3>
                <p>{{ company.address }}</p>
            </div>
        </div>
        
        <div class="map-container">
            <div id="map"></div>
            <div class="map-overlay">
                <button class="map-fullscreen-btn" onclick="expandMap()">
                    <i class="fas fa-expand"></i>
                </button>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Support Круг добра Card -->
    <div class="tooba-card support-card">
        <div class="support-content">
            <div class="support-icon">
                <i class="fas fa-hands-helping"></i>
            </div>
            <div class="support-text">
                <h3>Поддержите Круг добра</h3>
                <p>Помогите нам находить и поддерживать больше компаний-благотворителей</p>
            </div>
            <button class="support-btn">
                <i class="fas fa-heart"></i>
                <span>Поддержать</span>
            </button>
        </div>
    </div>
</div>

{% if company.latitude and company.longitude %}
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
<script>
document.addEventListener('DOMContentLoaded', function() {
    var map = L.map('map').setView([{{ company.latitude }}, {{ company.longitude }}], 15);
    
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© OpenStreetMap contributors'
    }).addTo(map);
    
    L.marker([{{ company.latitude }}, {{ company.longitude }}])
        .addTo(map)
        .bindPopup('<b>{{ company.name }}</b><br>{{ company.address }}')
        .openPopup();
});

function shareCompany() {
    if (navigator.share) {
        navigator.share({
            title: '{{ company.name }} - Круг добра',
            text: 'Компания-благотворитель: {{ company.name }}',
            url: window.location.href
        });
    } else {
        navigator.clipboard.writeText(window.location.href);
        // Show toast notification
        showToast('Ссылка скопирована!');
    }
}

function openMap() {
    const address = encodeURIComponent('{{ company.address }}');
    window.open(`https://yandex.ru/maps/?text=${address}`, '_blank');
}

function expandMap() {
    // Toggle fullscreen map
    document.getElementById('map').classList.toggle('map-fullscreen');
}

function showToast(message) {
    // Simple toast notification
    const toast = document.createElement('div');
    toast.className = 'tooba-toast';
    toast.textContent = message;
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.classList.add('show');
    }, 100);
    
    setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => document.body.removeChild(toast), 300);
    }, 3000);
}
</script>
{% endif %}
{% endblock %}